---
const flavors = [
  { id: "latte", name: "Latte", emoji: "ğŸŒ»" },
  { id: "frappe", name: "FrappÃ©", emoji: "ğŸª´" },
  { id: "macchiato", name: "Macchiato", emoji: "ğŸŒº" },
  { id: "mocha", name: "Mocha", emoji: "ğŸŒ¿" },
  { id: "auto", name: "Auto", emoji: "ğŸ–¥ï¸" },
];
---

<form
  id="flavour-switcher"
  class="
    mt-6
    flex gap-2 flex-wrap
">
  {
    flavors.map((flavor) => (
      <div class="
        flavour
        mt-2
      ">
        <input
          type="radio"
          name="flavour"
          id={flavor.id}
          value={flavor.id}
          aria-hidden
          class="hidden"
        />
        <label for={flavor.id} class="
          px-4 py-2
          bg-ctp-mantle hover:bg-ctp-mantle/80 dark:bg-ctp-mantle dark:hover:bg-ctp-mantle/80
          bg-linear-35 from-ctp-primary-400 to-ctp-secondary-400 hover:from-ctp-primary-500 hover:to-ctp-secondary-500
          text-sm font-semibold text-ctp-crust rounded-[2px]
          transition-colors
          whitespace-nowrap
        ">
          {flavor.emoji} {flavor.name}
        </label>
      </div>
    ))
  }
</form>

<script is:inline>
  function handleThemeChange() {
    const theme = document.querySelector('input[name="flavour"]:checked').value;
    if (theme === "auto") {
      const prefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;
      const defaultTheme = prefersDark ? "mocha" : "latte";
      document.documentElement.className = defaultTheme;
      localStorage.setItem("theme-auto", "true");
    } else {
      document.documentElement.className = theme;
      localStorage.setItem("theme", theme);
      localStorage.setItem("theme-auto", "false");
    }
  }

  const form = document.getElementById("flavour-switcher");
  const radioSelectors = form.querySelectorAll('input[type="radio"]');
  radioSelectors.forEach((selector) => {
    selector.addEventListener("change", handleThemeChange);
  });

  document.addEventListener("DOMContentLoaded", () => {
    const isThemeAuto = localStorage.getItem("theme-auto");
    if (isThemeAuto === "true") {
      const radioButton = document.getElementById("auto");
      if (!radioButton.checked) {
        radioButton.checked = true;
      }
      handleThemeChange();
    } else {
      const theme = localStorage.getItem("theme");
      if (theme) {
        const radioButton = document.getElementById(theme);
        if (!radioButton.checked) {
          radioButton.checked = true;
        }
        handleThemeChange();
      }
    }
  });

  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)");
  prefersDark.addEventListener("change", (event) => {
    const isThemeAuto = localStorage.getItem("theme-auto");
    if (isThemeAuto === "true") {
      const defaultTheme = event.matches ? "mocha" : "latte";
      document.documentElement.className = defaultTheme;
      localStorage.setItem("theme", defaultTheme);
    }
  });
</script>
